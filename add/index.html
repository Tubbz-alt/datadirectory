---
layout: nhse_default
---

{% include top_banner.html %}
<div class="outer-main-container">
  <div class="main-container">
    <h2>Open Health Data Usage</h2>
    <form data-bind="submit: postForm">
      <div class="grid">
        <div class="long-form">
          <label for="projectName">
            <div class="required">What is the name of your project?</div>
            <input data-bind="value: form.name, css: {error: invalid.name}" type="text">
          </label>
        </div>
        <div class="long-form">
          <label>
            Does your project have a website?
            <small class="help-text">
              We'd like to be able to link people to your project later on - if it's online please provide the url
            </small>
            <input data-bind="value: form.website"  type="text">
          </label>
        </div>
        <div class="long-form">
          <label>
            <div class="required">How did you use open health data?</div>
            <small class="help-text">
              We're looking to understand what your project does, what it's for, and how you used open health data
            </small>
            <textarea data-bind="value: form.how, css: {error: invalid.how}"></textarea>
          </label>
        </div>
        <div class="long-form">
          <label>
            <div class="required">What was the impact of your project?</div>
            <small class="help-text">
              We're trying to understand what happens next after people create their projects.
            </small>
            <textarea data-bind="value: form.impact, css: {error: invalid.impact}"></textarea>
          </label>
        </div>
        <div class="long-form">
          <label>What datasets did you use in your project? (Please include links if possible)
            <small class="help-text">
              We're trying to find out what currently available datasets people are finding most useful, and also map the space of open health data usage
            </small>
            <textarea data-bind="value: form.datasets"></textarea>
          </label>
        </div>
        <div class="long-form">
          <label>
            Is there an image that represents your project?
            <small class="help-text">
              We'd like show images that represent projects if we're linking to them.
            </small>
            <input data-bind="value: form.image" placeholder="If you have a logo or screenshot of your project online, please provide a link here" type="text">
          </label>
        </div>
        <div class="long-form">
          <label>What is the name of your organisation?
            <small class="help-text">If your project wasn't related to an organisation, that's ok too</small>
            <input data-bind="value: form.organisation" type="text">
          </label>
        </div>
        <div class="long-form">
          <label>
            What does your organisation do?
            <textarea data-bind="value: form.organisationPurpose"></textarea>
          </label>
        </div>
        <div class="long-form">
          <label>
            If your organization is a company, what is your company number?
            <small class="help-text">This lets us understand what kind of companies are using open health data</small>
            <textarea data-bind="value: form.companyNumber"></textarea>
          </label>
        </div>
        <div class="long-form">
          <label>
            How should we contact you?
            <small class="help-text">Just in case we want to get in touch to find out more. An email would be super.</small>
            <textarea data-bind="value: form.email"></textarea>
          </label>
        </div>
        <div class="long-form">
          <label>
            Do you mind us publishing your contact details so people can get in touch with you about your project?
            <input data-bind="value: form.contactable" type="checkbox">
          </label>
        </div>
        <div class="long-form">
          <label>
            Any other comments / feedback for us?
            <small class="help-text">Have we forgotten anything? Was anything on this form confusing? Just want to say hello?</small>
            <textarea data-bind="value: form.otherComments"></textarea>
          </label>
        </div>
        <div data-bind="if: errored" class="grid error">
          <div class="long-form text-centre error">
            Please fill in the required fields
          </div>
        </div>
      <div class="long-form text-centre">
        <button class="btn btn-primary btn-lg" type="submit">Add</button>
      </div>
    </div>
  </form>
</div>
<script>
  (function(){
      var AppViewModel = function(){
        var requiredFields = ["name", "how", "impact"];
        var self = this;
        this.form = {};
        this.invalid = {};
        this.errored = ko.observable(false);

        _.each(requiredFields, function(requiredField){
          self.form[requiredField] = ko.observable("");
          self.invalid[requiredField] = ko.observable(false);
          self.form[requiredField].subscribe(function(newValue){
              self.validateField(requiredField);
          });
        });

        this.validateField = function(requiredField){
          if(!self.form[requiredField]().length){
            self.invalid[requiredField](true)
            return requiredField;
          }
          else{
            self.invalid[requiredField](false)
          }
        }

        this.isValid = function(){
           var invalidFields = _.map(requiredFields, function(requiredField){
              return self.validateField(requiredField);
           });

           var isValid = !_.compact(invalidFields).length;
           self.errored(!isValid);
           return isValid;
        }

        this.postForm = function(){
          if(self.isValid()){
            // post
            var postDict = {};
            _.each(self.form, function(v, k){
                postDict["z_" + k] = ko.utils.unwrapObservable(v);
            });

            $.post('http://ohcucontakt.deadpansincerity.com/data-dictionary.php', postDict).then(
              function(){ window.location.href = "{{ site.baseurl }}" }
            )
            return false;
          }

          return false;
        }
      }
      var mpv = new AppViewModel();
      window.mpv = mpv;
      ko.applyBindings(mpv);
  }());
</script>
